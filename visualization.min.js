/**
 * Witti Visualization 1.0
 * http://www.witti.ws/project/witti-visualization
 * 
 * Copyright (c) 2012, Greg Payne
 * Dual licensed under the MIT and GPL licenses.
 */
document.write('<script type="text/javascript" src="'+(("https:"==document.location.protocol)?"https://":"http://")+"www.google.com/jsapi?autoload="+encodeURIComponent('{"modules":[{"name":"visualization","version":"1"}]}')+'"><\/script>');(function(c){var d=0;function a(){d++;return"html5-gv-id-"+d}var f={type:"chartType"};c("axisTitlesPosition backgroundColor chartArea enableInteractivity fontSize fontName gridlineColor hAxis isStacked legendTextStyle logScale maxAlternation maxValue minValue reverseCategories showTextEvery slantedText slantedTextAngle strokeWidth textPosition textStyle titlePosition titleTextStyle tooltipTextStyle vAxes vAxis viewWindowMode viewWindow".split(" ")).each(function(){f[this.toLowerCase()]=this});var b=function(){c(this).each(function(){c(this).attr("data-gv-applied","true");c(this).change(function(){c(this).removeAttr("data-gv-applied")});if(!this.id){this.id=a()}var o={chartType:"Table",dataTable:null,options:{}};if(c(this).width()/c(this).height()>20){c(this).height(250)}for(var l=0;l<this.attributes.length;l++){var j=this.attributes[l].name.toLowerCase();var s=this.attributes[l].value;if(j.indexOf("_")!=-1){var p=j.substr(j.indexOf("_")+1);j=j.substr(0,j.indexOf("_"));if(p=="csv"){var r=[];while(s.indexOf(",")!=-1){var m=s.substr(0,s.indexOf(","));s=s.substr(m.length+1);r.push(m)}if(s!=""){r.push(s)}s=r}else{if(p=="json"){if(s.indexOf('"')==-1&&s.indexOf("'")!=-1){s=s.replace(/'/g,'"')}s=c.parseJSON(s)}}}if(j.substr(0,8)=="data-gv-"){j=j.substr(8);if(typeof f[j]!="undefined"){j=f[j]}if(typeof o[j]=="undefined"){tgt=o.options}else{tgt=o}while(j.indexOf(".")!=-1){var p=j.substr(0,j.indexOf("."));if(typeof f[p]!="undefined"){p=f[p]}j=j.substr(p.length+1);if(typeof tgt[p]=="undefined"){tgt[p]={}}tgt=tgt[p]}if(typeof f[j]!="undefined"){j=f[j]}tgt[j]=s}}var n=function(){};var h=new google.visualization.DataTable();var t=null;o.dataTable=h;if(c("table:has(tbody):not(.google-visualization-table-table)",this).length==1){t=c("table:has(tbody):not(.sticky-header)",this).removeClass("sticky-table sticky-enabled");c("caption:first",t).each(function(){o.options.title=c(this).text()});t.insertAfter(this).hide();c("table.sticky-header",this).remove();e(h,t,this)}else{if(c(this).eq(0).attr("data-gv-datatable")){t=document.getElementById(c(this).eq(0).attr("data-gv-datatable"));if(t){e(h,t,this);if(o.chartType=="Table"){c(t).hide()}else{if(o.options.datatablehide){c(t).hide()}}}}else{return}}if(o.options.image=="true"||o.options.image=="print"){if(typeof canvg!="function"){c.getScript("http://canvg.googlecode.com/svn/trunk/rgbcolor.js");c.getScript("http://canvg.googlecode.com/svn/trunk/canvg.js")}var q=c(this);n=function(){if(typeof canvg!="function"||typeof RGBColor!="function"){setTimeout(n,500);return}var i=(o.options.image=="print")?4:1;var x=c('<canvas style="display:none;">').attr("id",this.id+"-canvas");x.width(q.width()*i).height(q.height()*i);q.after(x);var u=q.gv_svg(0);var w=function(A,y){var B="",z=[];var C=A.split(" "+y+'="');if(C.length==1||i==1){return A}B=C.shift();while(C.length!=0){B+=" "+y+'="';z=C.shift().split('"');B+=z.shift()*i;B+='"'+z.join('"')}return B};var v=function(A){var B="",y=[],D="",z="";var C=A.split(' d="M');if(C.length==1||i==1){return A}B=C.shift();while(C.length!=0){B+=' d="M';y=C.shift();while(y.length!=0){D=y.charAt(0);y=y.substr(1);if(D=='"'){B+=(z*i)+D+y;break}if("-0123456789.".indexOf(D)==-1){B+=(z*i)+D;z=""}else{z+=D}}}return B};u=w(w(w(w(u,"x"),"y"),"width"),"height");u=w(w(u,"font-size"),"stroke-width");u=v(u);canvg(this.id+"-canvas",u);x.width(x.width()*i).height(x.height()*i);var k=c("<img>").attr("src",c("#"+this.id+"-canvas")[0].toDataURL("image/png"));k.width(q.width()).height(q.height());q.html(k);x.remove()}}var g=new google.visualization.ChartWrapper(o);google.visualization.events.addListener(g,"ready",n);g.draw(c(this)[0]);c(this).data("gv_wrapper",g)})};function e(h,g,i){c("thead tr",g).children("td,th").each(function(k){var j=c("tbody tr:first",g).children("td,th").eq(k);if(j.is("th")||isNaN(j.text())){h.addColumn("string",c(this).text())}else{h.addColumn("number",c(this).text())}});c("tbody tr",g).each(function(){var j=[];c("th,td",this).each(function(){var k=c(this).text();if(k==""){j.push(null)}else{switch(h.getColumnType(j.length)){case"number":j.push(1*k);break;default:j.push(k);break}}});h.addRow(j)})}c.fn.gv=function(h,g){c(this).attr("data-gv-"+h,g).removeAttr("data-gv-applied").change()};c.fn.gv_edit=function(){var g=c(this)[0];var h=c(this).eq(0).data("gv_wrapper");google.load("visualization","1",{packages:["charteditor"],callback:function(){var i=new google.visualization.ChartEditor();google.visualization.events.addListener(i,"ok",function(){h=i.getChartWrapper();h.draw(g)});i.openDialog(h)}})};c.fn.gv_svg=function(j){var g="";try{g=c(this).find("svg").eq(0).parent().html()}catch(i){g=c(this).eq(0).find("iframe").contents().find("body").html()+""}if(g.indexOf("<svg")==-1){alert("Sorry, but the export to SVG only works when viewing a chart.");return}g=g.substring(g.indexOf("<svg")+4,g.indexOf("</svg>")+6);g='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"'+g;if(j){g="data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(g);if(j&&j!=-1){window.open(g,"svg_"+c(this).eq(0).attr("id"))}}return g};c(document).ready(function(){google.setOnLoadCallback(function(){var g="*[data-gv-type]:not([data-gv-applied])";if(typeof c.fn.on=="function"){c(document).on("change",g,b)}else{c(document).delegate(g,"change",b)}c(g).change()})})})(jQuery);